# vaik-anomaly-onnx-inference

Inference by anomaly ONNX model


## Install

``` shell
pip install git+https://github.com/vaik-info/vaik-anomaly-onnx-inference.git
```

## Requirement
- onnx model input shape
    - (batch, height, width, channel)

## Usage

### Example

```python
import os
import numpy as np
from PIL import Image

from vaik_anomaly_onnx_inference.onnx_model import OnnxModel

input_saved_model_dir_path = os.path.expanduser('~/.vaik_anomaly_pb_trainer/output/model.onnx')
model = OnnxModel(input_saved_model_dir_path)

image = np.asarray(Image.open(os.path.expanduser('~/.vaik-mnist-anomaly-dataset/train/good/0000.png')).convert('RGB'))
output, raw_pred = model.inference([image], batch_size=1)
print(output)
```

#### Output

- output

```text
[{'score': 1.072081322932861e-05}]
```

- raw_pred
```
[[[[3.85394815e-04 1.06056454e-03 3.88873217e-04]
   [5.46979172e-05 2.11541355e-05 2.91767610e-05]
   [1.56371279e-05 2.46054478e-05 4.84159464e-05]
   ...
   [2.27333894e-05 1.24226053e-05 1.60358468e-05]
   [1.25950455e-05 1.89529055e-05 3.56544369e-05]
   [3.88672255e-04 4.35621594e-04 1.15226267e-03]]

  [[6.27542104e-05 8.06827957e-05 1.22821817e-04]
   [1.99426086e-06 3.04242008e-07 2.76893820e-06]
   [2.19070353e-06 4.54087711e-07 9.86193982e-07]
   ...
   [5.03184367e-07 7.46859428e-08 1.51561744e-06]
   [1.54222312e-06 3.33826989e-07 6.46906642e-07]
   [7.60802322e-06 4.33158129e-06 2.23947645e-05]]

  [[3.27414673e-05 2.22848939e-05 2.25066033e-05]
   [1.05439835e-06 9.10233837e-07 7.56000247e-07]
   [3.00767056e-07 6.86172939e-07 1.03296452e-06]
   ...
   [4.55655510e-07 4.42157727e-07 4.48641686e-07]
   [2.53072585e-07 4.74146077e-07 8.19577394e-07]
   [2.38235261e-05 2.09490281e-05 4.75706984e-05]]

  ...

  [[2.33531155e-05 2.26723278e-05 2.58304735e-05]
   [5.54978271e-07 1.74356643e-07 4.70541210e-07]
   [1.56607530e-06 2.50709320e-07 3.53532670e-07]
   ...
   [1.57376769e-06 9.98246492e-07 2.44440594e-06]
   [3.46179058e-06 1.39125871e-06 2.04892194e-06]
   [1.27693138e-05 1.35873352e-05 3.49990478e-05]]

  [[2.09959780e-05 1.35875543e-05 1.69900559e-05]
   [8.08713651e-07 6.45852424e-07 4.63535002e-07]
   [2.99624048e-07 7.00416365e-07 1.13260876e-06]
   ...
   [1.78205255e-06 2.06396544e-06 1.48335721e-06]
   [2.55246277e-06 2.03401828e-06 4.50003790e-06]
   [8.16526081e-05 4.82965770e-05 1.04864688e-04]]

  [[6.85571809e-04 3.19959567e-04 2.09847279e-03]
   [8.11825521e-05 1.19364631e-04 3.70719536e-05]
   [9.26300636e-05 3.22254491e-05 2.17793495e-05]
   ...
   [9.27035071e-05 8.57288105e-05 8.55980688e-05]
   [1.60328345e-04 5.95132042e-05 6.11809955e-05]
   [2.05681031e-03 5.02371287e-04 1.79625687e-03]]]]
```